<!-- templates/ecnm/ecnm_idct/ecnm_idct.html -->
{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h3 class="mb-4">ì‹œì¥ì§€í‘œ</h3>
</div>

<p>{{ context.exrt_usd.today.proc_date }}</p>
<p>ì˜¤ëŠ˜í™˜ìœ¨ {{ context.exrt_usd.today.indx }}({{ context.exrt_usd.today.dif_indx }})</p>

<h3>ì—°ê°„ USD/KRW</h3>
<canvas id="usdYearChart" width="600" height="250"></canvas>
<br><br>
<h3>ì—°ê°„ ë‹¬ëŸ¬ì¸ë±ìŠ¤ (DXY)</h3>
<canvas id="dxyYearChart" width="600" height="250"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const yearData = {{ context.exrt_usd.year | tojson }};

    // ğŸ“Œ ë‚ ì§œë¥¼ YYYY-MM-DD ë¡œ ë³€í™˜
    const labels = yearData.map(item => {
        const d = item.proc_date; // "20250101"
        return `${d.slice(0,4)}-${d.slice(4,6)}-${d.slice(6,8)}`;
    });

    const usdValues = yearData.map(item => item.usd_indx);

    const ctx = document.getElementById('usdYearChart').getContext('2d');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'USD/KRW (1ë…„)',
                data: usdValues,
                borderWidth: 2,
                borderColor: 'blue',
                backgroundColor: 'rgba(0, 0, 255, 0.1)',
                tension: 0.3,
                pointRadius: 0     // â† ë™ê·¸ë¼ë¯¸ ì œê±°
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: false
                },
                x: {
                    ticks: {
                      autoSkip: false,
                      maxRotation: 45,
                      minRotation: 45,
                      callback: function(value, index) {
                          const label = this.getLabelForValue(value);

                          // YYYY-MM-DD â†’ ì›” ì²«ë‚ ë§Œ í‘œì‹œ
                          if (label.slice(8, 10) === "01") {
                              return label;
                          }

                          return "";
                      }
                    },
                    grid: {
                      drawOnChartArea: true,    // ì„¸ë¡œì„  ê·¸ë¦¬ê¸° í—ˆìš©
                      color: function(context) {
                          const label = context.chart.data.labels[context.index];
                          // ë‚ ì§œê°€ ì›” 1ì¼ì´ë©´ ì„ ì„ í‘œì‹œ
                          if (label.slice(8, 10) === "01") {
                              return '#cccccc';  // ì„¸ë¡œì„  ìƒ‰
                          }
                          return 'rgba(0,0,0,0)'; // ë‚˜ë¨¸ì§€ëŠ” íˆ¬ëª… (ì‹¤ì œë¡œ ì•ˆ ë³´ì„)
                      }
                    }
                }
            }
        }
    });
    /* ------------------------------
        ë‹¬ëŸ¬ì¸ë±ìŠ¤ (DXY) ê·¸ë˜í”„
        â†’ ìœ„ USD/KRW ê·¸ë˜í”„ì™€ ì™„ì „íˆ ë™ì¼í•œ ì„¤ì •
    ------------------------------ */

    const dxyData = {{ context.dxy_indx.year | tojson }};

    const dxyLabels = dxyData.map(item => {
        const d = item.proc_date;
        return `${d.slice(0,4)}-${d.slice(4,6)}-${d.slice(6,8)}`;
    });

    const dxyValues = dxyData.map(item => item.dxy_indx);

    const dxyCtx = document.getElementById('dxyYearChart').getContext('2d');

    new Chart(dxyCtx, {
        type: 'line',
        data: {
            labels: dxyLabels,
            datasets: [{
                label: 'DXY ë‹¬ëŸ¬ì¸ë±ìŠ¤ (1ë…„)',
                data: dxyValues,
                borderWidth: 2,
                borderColor: 'green',                // ìƒ‰ë§Œ USDì™€ êµ¬ë¶„
                backgroundColor: 'rgba(0, 128, 0, 0.1)',
                tension: 0.3,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: false },
                x: {
                    ticks: {
                        autoSkip: false,
                        maxRotation: 45,
                        minRotation: 45,
                        callback: function(value, index) {
                            const label = this.getLabelForValue(value);
                            return label.slice(8,10) === "01" ? label : "";
                        }
                    },
                    grid: {
                        drawOnChartArea: true,
                        color: function(context) {
                            const label = context.chart.data.labels[context.index];
                            return label.slice(8,10) === "01" ? '#cccccc' : 'rgba(0,0,0,0)';
                        }
                    }
                }
            }
        }
    });    
</script>

{% endblock %}
